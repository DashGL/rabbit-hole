---
import Base from "@layouts/Base.astro";
import Link from "@components/Link.astro";

const steps = [
    {
        title: "Prologue",
        href: "/story/prologue",
        filled: false,
    },
    {
        title: "Forward",
        href: "/story/forward",
        filled: false,
    },
    {
        title: "Brickout",
        href: "/story/brickout",
        filled: false,
    },
    {
        title: "Snake",
        href: "/story/snake",
        filled: false,
    },
    {
        title: "Tetris",
        href: "/story/tetris",
        filled: false,
    },
    {
        title: "Invaders",
        href: "/story/invaders",
        filled: false,
    },
    {
        title: "Astroids",
        href: "/story/astroids",
        filled: false,
    },
    {
        title: "Flappy Bird",
        href: "/story/flappy",
        filled: false,
    },
    {
        title: "Epilogue",
        href: "/story/epilogue",
        filled: false,
    },
];

let index = -1;
const { pathname } = Astro.url;
for (let i = 0; i < steps.length; i++) {
    const { href } = steps[i]!;
    steps[i]!.filled = true;
    if (pathname.includes(href)) {
        index = i;
        break;
    }
}
const prev = steps[index - 1];
const next = steps[index + 1];
---

<Base>
    <div class="max-w-screen-xl mx-auto flex flex-wrap py-6">
        <aside class="w-full md:w-1/3 flex flex-col items-center px-3">
            <ul class="steps steps-vertical">
                {
                    steps.map((step) => (
                        <li
                            class:list={["step", step.filled && "step-primary"]}
                        >
                            <Link href={step.href}>{step.title}</Link>
                        </li>
                    ))
                }
            </ul>
        </aside>
        <!-- Posts Section -->
        <section class="w-full md:w-2/3 flex flex-col px-3 space-y-4 prose">
            <slot />
            <!-- Page navigation -->
            <div
                class="sm:flex items-center justify-between py-8 space-y-6 sm:space-y-0 sm:space-x-4"
            >
                {
                    prev && (
                        <div class="sm:w-1/2 sm:flex flex-col items-start">
                            <div>
                                <div class="text-xs font-[650] text-blue-600 uppercase mb-1">
                                    Prev
                                </div>
                                <div>
                                    <Link href={prev.href}>
                                        <span class="text-slate-800 font-[650] flex items-center dark:text-slate-200">
                                            <svg
                                                class="fill-slate-400 shrink-0 mr-2 rotate-180 dark:fill-slate-500"
                                                width="8"
                                                height="10"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path d="M1 2 2.414.586 6.828 5 2.414 9.414 1 8l3-3z" />
                                            </svg>
                                            <span>{prev.title}</span>
                                        </span>
                                    </Link>
                                </div>
                            </div>
                        </div>
                    )
                }

                {
                    next && (
                        <div class="sm:w-1/2 sm:flex flex-col items-end ml-auto">
                            <div>
                                <div class="text-xs font-[650] text-blue-600 uppercase mb-1">
                                    Next
                                </div>
                                <div>
                                    <Link href={next.href}>
                                        <span class="text-slate-800 font-[650] flex items-center dark:text-slate-200">
                                            <span>{next.title}</span>
                                            <svg
                                                class="fill-slate-400 shrink-0 ml-2 dark:fill-slate-500"
                                                width="8"
                                                height="10"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path d="M1 2 2.414.586 6.828 5 2.414 9.414 1 8l3-3z" />
                                            </svg>
                                        </span>
                                    </Link>
                                </div>
                            </div>
                        </div>
                    )
                }
            </div>
        </section>
    </div>
</Base>
